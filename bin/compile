#!/usr/bin/env ruby

require_relative "../config/environment"

$stdout.sync = true

require "language_pack/shell_helpers"

begin
  build_dir, cache_dir, env_dir = ARGV
  LanguagePack::ShellHelpers.initialize_env(env_dir)
  if pack = BootbootBuildpack.detect(build_dir, cache_dir)
    pack.topic("Compiling #{pack.name}")
    pack.log("compile") do
      pack.compile
    end
  end
rescue Exception => e
  LanguagePack::ShellHelpers.display_error_and_exit(e)
end
